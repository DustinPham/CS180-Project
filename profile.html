<html>
	<head>
		<meta charset="UTF-8">
		<script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>	
		<title>Profile</title>
	</head>
	
	<body>
		<ul class="nav nav-tabs">
			<li role="presentation" class "active"><a href="#">Home</a></li>
		</ul>	
		<textarea id="newMessage" rows="5" cols="40"></textarea>
		<button id="send">Send</button>
		<script type="text/javascript">
			function getNewMessages(t){
				//somehow get the user name from the session variable
				var username = "alex";
				var recpUser = "ying";
				$.ajax({
					type: 'GET',
					url: './messages.php',
					data: {username:username, recpUser: recpUser, time:t},
					success: function(data){
						var obj = jQuery.parseJSON(data);
						if(obj.message != ""){
							var messageArray = obj.message;
							for(var i = 0; i < messageArray.length; i++){
								console.log(messageArray[i]);
							}
							console.log(obj.timestamp);
						}
						getNewMessages(obj.timestamp);
					}
				});
			}
					
			$('#send').click(function()
			{
				var message = $('#newMessage').val();
				var t = (new Date).getTime();
				$.ajax(
				{
					type: "POST",
					url: './sendmessage.php',
					data: {username:username, recpUser:recpUser, time:t , message:message},
					success: function(data)
					{
						if(data.message == message)
						{
							console.log("success");
						}
					}
				})
			});
	
			$(function(){
				var time = null;
				getNewMessages(time);
			});
		</script>
	</body>
</html>
